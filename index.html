<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·∫£i Ph√°p To√†n Di·ªán Cho T∆∞∆°ng Lai C·ªßa B·∫°n</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom animations for the app */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes scaleIn {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeZoom {
            from { opacity: 0.5; transform: scale(1.05); }
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes bounceSlow {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .animate-fadeIn { animation: fadeIn 0.5s ease-out forwards; }
        .animate-scaleIn { animation: scaleIn 0.3s ease-out forwards; }
        .animate-fadeZoom { animation: fadeZoom 0.6s ease-out forwards; }
        .animate-bounce-slow { animation: bounceSlow 2s infinite ease-in-out; }
        .animate-fadeInContent { animation: fadeIn 0.4s ease-out forwards; }

        /* General body styling and font */
        body {
            font-family: "Inter", sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            background-color: #f9fafb; /* bg-gray-50 */
            color: #374151; /* text-gray-800 */
        }
        /* Style for text generated by LLM that might contain markdown-like lists */
        .prose ul {
            list-style-type: disc;
            margin-left: 1.5em;
        }
        .prose ol {
            list-style-type: decimal;
            margin-left: 1.5em;
        }
        .prose li {
            margin-bottom: 0.5em;
        }
        .prose h3 {
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 1em;
            margin-bottom: 0.5em;
        }
        .prose strong {
            font-weight: bold;
        }

        /* Adjustments for fixed buttons to prevent overlap on small screens */
        @media (max-width: 767px) { /* Below md breakpoint */
            #open-ai-chat-button {
                bottom: 130px; /* Slightly higher for better separation */
                left: 20px;
                right: auto; /* Ensure it's not right-aligned */
                transform: none; /* Remove any horizontal transform */
            }
            #open-comparison-modal-button {
                bottom: 75px; /* Moved higher than scroll-to-top and aligned to the right */
                left: auto; /* Remove left-50% centering */
                right: 20px; /* Align to right */
                transform: none; /* Remove transformX to prevent horizontal overlap */
            }
            #scroll-to-top-button {
                bottom: 20px; /* Keep closer to bottom, aligned to the right */
                right: 20px;
            }
        }

        /* Ensure enough padding at the bottom of the body so fixed elements don't hide content */
        body {
            padding-bottom: 150px; /* Adjust as needed based on fixed element heights */
        }
    </style>
</head>
<body>
    <!-- Global User ID Display -->
    <div id="userIdDisplay" class="fixed top-0 left-0 bg-blue-800 text-white text-xs px-2 py-1 rounded-br-lg z-50 hidden">
        User ID: <span id="currentUserId"></span>
    </div>

    <!-- Main Application Container -->
    <div id="app-root">
        <!-- Hero Section -->
        <section
            class="relative h-screen flex flex-col items-center justify-center text-white text-center p-4 bg-gradient-to-br from-indigo-700 to-purple-900 overflow-hidden"
        >
            <div class="absolute inset-0 z-0 opacity-20" style="background-image: url('https://www.transparenttextures.com/patterns/cubes.png');"></div>
            <div class="relative z-10 animate-fadeIn duration-1000">
                <h1 class="text-6xl md:text-7xl font-extrabold mb-6 drop-shadow-lg leading-tight">
                    Gi·∫£i Ph√°p To√†n Di·ªán Cho T∆∞∆°ng Lai C·ªßa B·∫°n
                </h1>
                <p class="text-xl md:text-2xl mb-10 opacity-90 max-w-xl md:max-w-3xl lg:max-w-4xl xl:max-w-5xl mx-auto">
                    Ch√∫ng t√¥i cung c·∫•p c√°c d·ªãch v·ª• t√†i ch√≠nh v√† c√¥ng ngh·ªá ti√™n ti·∫øn ƒë·ªÉ h·ªó tr·ª£ c√° nh√¢n v√† doanh nghi·ªáp ph√°t tri·ªÉn b·ªÅn v·ªØng.
                </p>
                <button
                    id="heroContactButton"
                    class="px-10 py-4 bg-white text-indigo-700 font-bold text-lg rounded-full shadow-xl hover:bg-gray-100 transition duration-300 transform hover:scale-105 animate-bounce-slow"
                >
                    Li√™n H·ªá Ngay
                </button>
            </div>
        </section>

        <!-- About Us section -->
        <section class="container mx-auto bg-white rounded-2xl shadow-xl p-8 mb-12 -mt-16 relative z-20 transform transition-all duration-500 hover:scale-[1.01] lg:max-w-screen-xl 2xl:max-w-screen-2xl">
            <h2 class="text-4xl font-bold text-center mb-6 text-indigo-700">V·ªÅ Ch√∫ng T√¥i</h2>
            <div class="flex flex-col md:flex-row items-center gap-8">
                <div class="md:w-1/2">
                    <img
                        src="https://placehold.co/600x400/9ca3af/ffffff?text=Our+Team"
                        alt="ƒê·ªôi ng≈© c·ªßa ch√∫ng t√¥i"
                        class="rounded-xl shadow-lg w-full h-auto object-cover"
                        onerror="this.onerror=null; this.src='https://placehold.co/600x400/cccccc/333333?text=Anh+Gioi+Thieu';"
                    />
                </div>
                <div class="md:w-1/2 text-left">
                    <p class="text-lg leading-relaxed mb-4 text-gray-700">
                        Ch√∫ng t√¥i l√† m·ªôt ƒë·ªôi ng≈© chuy√™n nghi·ªáp, t·∫≠n t√¢m mang ƒë·∫øn nh·ªØng gi·∫£i ph√°p t√†i ch√≠nh v√† c√¥ng ngh·ªá ti√™n ti·∫øn, to√†n di·ªán nh·∫•t cho kh√°ch h√†ng t·∫°i Vi·ªát Nam. V·ªõi nhi·ªÅu nƒÉm kinh nghi·ªám, ch√∫ng t√¥i t·ª± h√†o l√† ƒë·ªëi t√°c ƒë√°ng tin c·∫≠y, lu√¥n l·∫Øng nghe v√† ƒë√°p ·ª©ng m·ªçi nhu c·∫ßu c·ªßa b·∫°n, t·ª´ gi·∫£i ph√°p kinh doanh, d·ªãch v·ª• t√†i ch√≠nh c√° nh√¢n ƒë·∫øn c√°c thi·∫øt b·ªã c√¥ng ngh·ªá hi·ªán ƒë·∫°i.
                    </p>
                    <p class="text-lg leading-relaxed text-gray-700">
                        M·ª•c ti√™u c·ªßa ch√∫ng t√¥i l√† gi√∫p b·∫°n ƒë·∫°t ƒë∆∞·ª£c hi·ªáu qu·∫£ t·ªëi ƒëa trong c√¥ng vi·ªác v√† cu·ªôc s·ªëng, th√¥ng qua c√°c s·∫£n ph·∫©m v√† d·ªãch v·ª• ch·∫•t l∆∞·ª£ng cao c√πng s·ª± h·ªó tr·ª£ chuy√™n nghi·ªáp, nhanh ch√≥ng. Ch√∫ng t√¥i kh√¥ng ng·ª´ng c·∫£i ti·∫øn ƒë·ªÉ mang l·∫°i gi√° tr·ªã v∆∞·ª£t tr·ªôi.
                    </p>
                </div>
            </div>
        </section>

        <!-- Search Bar -->
        <div class="container mx-auto mb-8 px-4 lg:max-w-screen-xl 2xl:max-w-screen-2xl">
            <input
                type="text"
                id="search-input"
                placeholder="T√¨m ki·∫øm d·ªãch v·ª•..."
                class="w-full p-4 rounded-xl shadow-md border border-gray-200 focus:outline-none focus:ring-4 focus:ring-indigo-300 transition duration-300 text-lg"
                aria-label="T√¨m ki·∫øm d·ªãch v·ª•"
            />
        </div>

        <!-- Navigation Bar for categories (Responsive with Hamburger) -->
        <nav class="container mx-auto bg-white rounded-2xl shadow-xl p-4 mb-12 lg:max-w-screen-xl 2xl:max-w-screen-2xl">
            <div class="md:hidden flex justify-end">
                <button
                    id="nav-toggle"
                    class="p-2 text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-md"
                    aria-label="M·ªü/ƒë√≥ng menu ƒëi·ªÅu h∆∞·ªõng"
                >
                    <svg id="nav-toggle-icon" class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
            <ul id="category-nav" class="flex flex-wrap justify-center gap-3 md:flex hidden"></ul>
        </nav>

        <!-- Main content area -->
        <main class="container mx-auto px-4 lg:max-w-screen-xl 2xl:max-w-screen-2xl">
            <!-- Category Banner Image -->
            <div id="category-banner" class="w-full h-64 md:h-80 lg:h-96 mb-12 rounded-2xl overflow-hidden shadow-xl hidden">
                <img
                    id="category-banner-img"
                    src=""
                    alt="Banner danh m·ª•c"
                    class="w-full h-full object-cover object-center animate-fadeZoom"
                    onerror="this.onerror=null; this.src='https://placehold.co/1920x600/cccccc/333333?text=Khong+Tai+Duoc+Anh';"
                />
            </div>

            <!-- Loading Spinner -->
            <div id="loading-spinner" class="flex justify-center items-center h-64 hidden">
                <div class="animate-spin rounded-full h-20 w-20 border-t-4 border-b-4 border-indigo-500"></div>
            </div>

            <!-- Services grid displaying filtered services -->
            <div id="services-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Service cards will be inserted here by JavaScript -->
            </div>
        </main>

        <!-- Our Process Section -->
        <section class="container mx-auto bg-white rounded-2xl shadow-xl p-8 mt-16 mb-12 text-center px-4 lg:max-w-screen-xl 2xl:max-w-screen-2xl">
            <h2 class="text-4xl font-bold text-indigo-700 mb-10">Quy Tr√¨nh L√†m Vi·ªác C·ªßa Ch√∫ng T√¥i</h2>
            <div id="process-steps-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Process steps will be inserted here by JavaScript -->
            </div>
        </section>

        <!-- Testimonials Section -->
        <section class="bg-gradient-to-r from-indigo-600 to-purple-700 text-white p-8 mt-16 mb-12 relative overflow-hidden">
            <div class="container mx-auto relative z-10 px-4 lg:max-w-screen-xl 2xl:max-w-screen-2xl">
                <h2 class="text-4xl font-bold text-center mb-10">Kh√°ch H√†ng N√≥i G√¨ V·ªÅ Ch√∫ng T√¥i</h2>
                <div id="testimonials-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <p id="loading-testimonials" class="col-span-full text-center text-white opacity-80 text-xl py-10">ƒêang t·∫£i ƒë√°nh gi√° kh√°ch h√†ng...</p>
                </div>
            </div>
            <div class="absolute top-0 left-0 w-full h-full opacity-10 z-0" style="background-image: url('https://www.transparenttextures.com/patterns/lined-paper.png');"></div>
        </section>

        <!-- FAQ Section -->
        <section class="container mx-auto bg-white rounded-2xl shadow-xl p-8 mt-16 mb-12 px-4 lg:max-w-screen-xl 2xl:max-w-screen-2xl">
            <h2 class="text-4xl font-bold text-indigo-700 text-center mb-10">C√¢u H·ªèi Th∆∞·ªùng G·∫∑p</h2>
            <div id="faq-list" class="space-y-4 max-w-3xl mx-auto md:max-w-5xl lg:max-w-6xl">
                <!-- FAQs will be inserted here by JavaScript -->
            </div>
        </section>

        <!-- Contact Form Section -->
        <section id="contact-form-section" class="container mx-auto bg-white rounded-2xl shadow-xl p-8 mt-16 mb-12 px-4 lg:max-w-screen-xl 2xl:max-w-screen-2xl">
            <h2 class="text-4xl font-bold text-indigo-700 text-center mb-10">G·ª≠i Y√™u C·∫ßu Li√™n H·ªá</h2>
            <form id="contact-form" class="max-w-xl mx-auto space-y-6">
                <div>
                    <label for="contactName" class="block text-gray-700 text-lg font-semibold mb-2">
                        H·ªç v√† T√™n:
                    </label>
                    <input
                        type="text"
                        id="contactName"
                        name="name"
                        class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 text-lg transition duration-200"
                        placeholder="Nh·∫≠p h·ªç v√† t√™n c·ªßa b·∫°n"
                        required
                    />
                </div>
                <div>
                    <label for="contactEmail" class="block text-gray-700 text-lg font-semibold mb-2">
                        Email:
                    </label>
                    <input
                        type="email"
                        id="contactEmail"
                        name="email"
                        class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 text-lg transition duration-200"
                        placeholder="Nh·∫≠p email c·ªßa b·∫°n"
                        required
                    />
                </div>
                <div>
                    <label for="contactPhone" class="block text-gray-700 text-lg font-semibold mb-2">
                        S·ªë ƒëi·ªán tho·∫°i:
                    </label>
                    <input
                        type="tel"
                        id="contactPhone"
                        name="phone"
                        class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 text-lg transition duration-200"
                        placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i c·ªßa b·∫°n (t√πy ch·ªçn)"
                    />
                </div>
                <div>
                    <label for="contactMessage" class="block text-gray-700 text-lg font-semibold mb-2">
                        Tin nh·∫Øn:
                    </label>
                    <textarea
                        id="contactMessage"
                        name="message"
                        rows="6"
                        class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 text-lg transition duration-200"
                        placeholder="N·ªôi dung b·∫°n mu·ªën li√™n h·ªá..."
                        required
                    ></textarea>
                </div>
                <p id="form-feedback" class="text-center font-semibold text-lg"></p>
                <div class="text-center">
                    <button
                        type="submit"
                        id="contact-submit-button"
                        class="px-8 py-4 bg-gradient-to-r from-indigo-600 to-purple-700 text-white font-bold text-lg rounded-full shadow-lg hover:from-indigo-700 hover:to-purple-800 transition-all duration-300 transform hover:scale-105"
                    >
                        G·ª≠i Y√™u C·∫ßu
                    </button>
                </div>
            </form>
        </section>

        <!-- Service Detail Modal -->
        <div id="service-detail-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-50 animate-fadeIn overflow-auto hidden">
            <div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full p-8 relative animate-scaleIn transform scale-100 opacity-100 md:max-w-4xl lg:max-w-5xl xl:max-w-6xl">
                <button
                    id="close-service-modal"
                    class="absolute top-4 right-4 text-gray-500 hover:text-gray-900 text-4xl font-bold transition-colors duration-200"
                    aria-label="ƒê√≥ng"
                >
                    &times;
                </button>
                <h2 id="modal-service-name" class="text-4xl font-bold text-gray-900 mb-6 text-center"></h2>
                <div class="mb-6 rounded-lg overflow-hidden shadow-lg border border-gray-200">
                    <img id="modal-service-image" src="" alt="" class="w-full h-auto object-cover max-h-96" onerror="this.onerror=null; this.src='https://placehold.co/800x600/cccccc/333333?text=Khong+Tai+Duoc+Anh';" />
                </div>
                <p id="modal-service-long-description" class="text-gray-700 text-lg leading-relaxed mb-8"></p>

                <!-- AI Generate Key Benefits Button -->
                <div class="text-center mb-8">
                    <button
                        id="generate-benefits-button"
                        class="inline-flex items-center px-6 py-3 bg-blue-500 text-white font-bold rounded-full shadow-lg hover:bg-blue-600 transition-colors duration-200 text-lg transform hover:scale-105"
                    >
                        <span id="generate-benefits-spinner" class="animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white mr-2 hidden"></span>
                        <span id="generate-benefits-text">‚ú® G·ª£i √Ω L·ª£i √≠ch ch√≠nh ‚ú®</span>
                    </button>
                </div>
                <!-- Display Generated Benefits -->
                <div id="generated-benefits-container" class="bg-gray-100 p-6 rounded-lg mb-8 shadow-inner animate-fadeInContent hidden">
                    <h3 class="text-2xl font-bold text-gray-900 mb-3">L·ª£i √≠ch ch√≠nh:</h3>
                    <div id="generated-benefits-content" class="prose max-w-none text-gray-700"></div>
                </div>

                <!-- Ask AI about this Service Section -->
                <div class="bg-gray-50 p-6 rounded-lg mb-8 shadow-md">
                    <h3 class="text-2xl font-bold text-gray-900 mb-4 text-center">H·ªèi AI v·ªÅ d·ªãch v·ª• n√†y ‚ú®</h3>
                    <input
                        type="text"
                        id="specific-service-question-input"
                        class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 text-lg mb-4"
                        placeholder="V√≠ d·ª•: 'D·ªãch v·ª• n√†y c√≥ h·ªó tr·ª£ tr·∫£ g√≥p kh√¥ng?'"
                    />
                    <div class="text-center mb-4">
                        <button
                            id="ask-specific-service-button"
                            class="inline-flex items-center px-6 py-3 bg-green-500 text-white font-bold rounded-full shadow-lg hover:bg-green-600 transition-colors duration-200 text-lg transform hover:scale-105"
                        >
                            <span id="ask-specific-service-spinner" class="animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white mr-2 hidden"></span>
                            <span id="ask-specific-service-text">H·ªèi AI</span>
                        </button>
                    </div>
                    <div id="specific-service-answer-container" class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 animate-fadeInContent hidden">
                        <h4 class="text-xl font-bold text-gray-900 mb-2">Tr·∫£ l·ªùi t·ª´ AI:</h4>
                        <p id="specific-service-answer-content" class="text-gray-700 text-lg"></p>
                    </div>
                </div>

                <div class="flex justify-center flex-wrap gap-4">
                    <a
                        id="call-service-button"
                        href="tel:0363798989"
                        class="inline-flex items-center px-8 py-4 bg-green-600 text-white font-bold rounded-full shadow-lg hover:bg-green-700 transition-colors duration-200 text-lg transform hover:scale-105"
                    >
                        <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"></path>
                        </svg>
                        G·ªçi Ngay T∆∞ V·∫•n
                    </a>
                    <button
                        id="close-service-modal-bottom"
                        class="inline-flex items-center px-8 py-4 bg-gray-200 text-gray-800 font-bold rounded-full shadow-lg hover:bg-gray-300 transition-colors duration-200 text-lg transform hover:scale-105"
                    >
                        ƒê√≥ng
                    </button>
                </div>
            </div>
        </div>

        <!-- AI Chat Assistant Modal -->
        <div id="ai-chat-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 animate-fadeIn hidden">
            <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full p-6 relative animate-scaleIn flex flex-col h-[80vh]">
                <button
                    id="close-ai-chat-modal"
                    class="absolute top-4 right-4 text-gray-500 hover:text-gray-900 text-4xl font-bold transition-colors duration-200"
                    aria-label="ƒê√≥ng tr·ª£ l√Ω AI"
                >
                    &times;
                </button>
                <h2 class="text-3xl font-bold text-gray-900 mb-4 text-center border-b pb-2">‚ú® Tr·ª£ l√Ω D·ªãch v·ª• AI ‚ú®</h2>
                <div id="ai-chat-history" class="flex-grow overflow-y-auto mb-4 p-2 border rounded-lg bg-gray-50"></div>
                <div class="flex gap-2">
                    <input
                        type="text"
                        id="ai-user-input"
                        class="flex-grow p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="M√¥ t·∫£ nhu c·∫ßu c·ªßa b·∫°n (v√≠ d·ª•: 't√¥i c·∫ßn vay ti·ªÅn mua nh√†')"
                    />
                    <button
                        id="ai-send-message-button"
                        class="p-3 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition-colors duration-200 shadow-md flex items-center justify-center"
                    >
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Service Comparison Modal -->
        <div id="service-comparison-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 animate-fadeIn overflow-auto hidden">
            <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full p-8 relative animate-scaleIn flex flex-col max-h-[90vh]">
                <button
                    id="close-comparison-modal"
                    class="absolute top-4 right-4 text-gray-500 hover:text-gray-900 text-4xl font-bold transition-colors duration-200"
                    aria-label="ƒê√≥ng c√¥ng c·ª• so s√°nh"
                >
                    &times;
                </button>
                <h2 class="text-3xl font-bold text-gray-900 mb-6 text-center border-b pb-2">‚ú® So s√°nh D·ªãch v·ª• ‚ú®</h2>
                <div class="flex flex-col md:flex-row gap-6 mb-6">
                    <div class="md:w-1/2">
                        <label for="service1-select" class="block text-gray-700 text-lg font-semibold mb-2">
                            Ch·ªçn D·ªãch v·ª• 1:
                        </label>
                        <select
                            id="service1-select-compare"
                            class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 text-lg"
                        >
                            <option value="">-- Ch·ªçn d·ªãch v·ª• --</option>
                        </select>
                    </div>
                    <div class="md:w-1/2">
                        <label for="service2-select" class="block text-gray-700 text-lg font-semibold mb-2">
                            Ch·ªçn D·ªãch v·ª• 2:
                        </label>
                        <select
                            id="service2-select-compare"
                            class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 text-lg"
                        >
                            <option value="">-- Ch·ªçn d·ªãch v·ª• --</option>
                        </select>
                    </div>
                </div>
                <p id="comparison-error-message" class="text-red-600 text-center mb-4 hidden"></p>
                <div class="text-center mb-6">
                    <button
                        id="compare-button"
                        class="inline-flex items-center px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold rounded-full shadow-lg hover:from-purple-700 hover:to-pink-700 transition-all duration-300 transform hover:scale-105 text-lg"
                    >
                        <span id="compare-spinner" class="animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-white mr-3 hidden"></span>
                        <span id="compare-text">So s√°nh ‚ú®</span>
                    </button>
                </div>
                <div id="comparison-result-container" class="flex-grow overflow-y-auto bg-gray-100 p-6 rounded-lg shadow-inner animate-fadeInContent hidden">
                    <h3 class="text-2xl font-bold text-gray-900 mb-4">K·∫øt qu·∫£ so s√°nh:</h3>
                    <div id="comparison-result-content" class="prose max-w-none text-gray-700"></div>
                </div>
            </div>
        </div>

        <!-- Floating AI Assistant Button -->
        <button
            id="open-ai-chat-button"
            class="fixed bottom-[130px] left-5 bg-blue-600 text-white p-4 rounded-full shadow-xl hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-300 z-40 transform hover:scale-110 flex items-center justify-center text-lg font-semibold"
            title="Tr·ª£ l√Ω AI"
        >
            <svg class="w-7 h-7 mr-2" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM8 12c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm4 0c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm4 0c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"></path>
            </svg>
            Tr·ª£ l√Ω AI ‚ú®
        </button>

        <!-- Floating Service Comparison Button -->
        <button
            id="open-comparison-modal-button"
            class="fixed bottom-[75px] right-5 bg-purple-600 text-white p-4 rounded-full shadow-xl hover:bg-purple-700 focus:outline-none focus:ring-4 focus:ring-purple-300 transition-all duration-300 z-40 transform hover:scale-110 flex items-center justify-center text-lg font-semibold"
            title="So s√°nh D·ªãch v·ª•"
        >
            <svg class="w-7 h-7 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
            </svg>
            So s√°nh D·ªãch v·ª• ‚ú®
        </button>

        <!-- "Back to Top" button -->
        <button
            id="scroll-to-top-button"
            class="fixed bottom-5 right-5 bg-indigo-600 text-white p-4 rounded-full shadow-xl hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-300 transition-opacity duration-300 z-40 transform hover:scale-110 hidden"
            title="Cu·ªôn l√™n ƒë·∫ßu trang"
        >
            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
            </svg>
        </button>

        <!-- Contact information section -->
        <footer class="container mx-auto text-center py-12 mt-16 bg-gradient-to-r from-indigo-700 to-purple-800 text-white rounded-2xl shadow-xl px-4 lg:max-w-screen-xl 2xl:max-w-screen-2xl">
            <h3 class="text-4xl font-bold mb-6">Li√™n H·ªá Ngay ƒê·ªÉ ƒê∆∞·ª£c T∆∞ V·∫•n!</h3>
            <p class="text-xl mb-3">
                üìû ƒêi·ªán tho·∫°i: <a href="tel:0363798989" class="underline font-semibold hover:text-blue-200 transition-colors duration-200">0363.79.89.89</a>
            </p>
            <p class="text-xl mb-8">
                üë§ Ng∆∞·ªùi li√™n h·ªá: <span class="font-semibold">Hi·∫øu</span>
            </p>
            <div class="flex justify-center space-x-8 mt-6">
                <a href="https://facebook.com" target="_blank" rel="noopener noreferrer" class="text-white hover:text-blue-200 transition-colors duration-200 transform hover:scale-110" aria-label="Truy c·∫≠p trang Facebook c·ªßa ch√∫ng t√¥i">
                    <svg fill="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" class="w-10 h-10" viewBox="0 0 24 24">
                        <path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"></path>
                    </svg>
                </a>
                <a href="https://zalo.me/0363798989" target="_blank" rel="noopener noreferrer" class="text-white hover:text-blue-200 transition-colors duration-200 transform hover:scale-110" aria-label="Nh·∫Øn tin cho ch√∫ng t√¥i qua Zalo">
                    <svg fill="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="0" class="w-10 h-10" viewBox="0 0 24 24">
                        <path d="M12.001 0C5.373 0 0 5.373 0 12.001C0 18.628 5.373 24 12.001 24C18.628 24 24 18.628 24 12.001C24 5.373 18.628 0 12.001 0ZM12 1.83C17.618 1.83 22.17 6.382 22.17 12C22.17 17.618 17.618 22.17 12 22.17C6.382 22.17 1.83 17.618 1.83 12C1.83 6.382 6.382 1.83 12 1.83ZM16.035 16.536C15.696 16.874 15.289 17.065 14.882 17.065C14.475 17.065 14.068 16.874 13.729 16.536L12 14.807L10.271 16.536C9.932 16.874 9.525 17.065 9.118 17.065C8.711 17.065 8.304 16.874 7.965 16.536C7.288 15.859 7.288 14.752 7.965 14.075L9.694 12.346L7.965 10.617C7.288 9.94 7.288 8.833 7.965 8.156C8.642 7.479 9.749 7.479 10.426 8.156L12 9.885L13.574 8.156C14.251 7.479 15.358 7.479 16.035 8.156C16.712 8.833 16.712 9.94 16.035 10.617L14.306 12.346L16.035 14.075C16.712 14.752 16.712 15.859 16.035 16.536Z"></path>
                    </svg>
                </a>
            </div>
            <p class="text-lg mt-4 opacity-80">
                Ch√∫ng t√¥i lu√¥n s·∫µn l√≤ng l·∫Øng nghe v√† h·ªó tr·ª£ b·∫°n.
            </p>
        </footer>
    </div>

    <!-- Firebase CDN -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Global Variable Declarations for Canvas Environment ---
        // These variables are provided by the Canvas runtime.
        const __app_id = typeof window.__app_id !== 'undefined' ? window.__app_id : 'default-app-id';
        const __firebase_config = typeof window.__firebase_config !== 'undefined' ? JSON.parse(window.__firebase_config) : {};
        const __initial_auth_token = typeof window.__initial_auth_token !== 'undefined' ? window.__initial_auth_token : undefined;

        let db;
        let currentUserId = null;
        let isAuthReady = false;
        let canvasAppId = __app_id; // Use the provided app ID

        // Initialize Firebase
        try {
            const app = initializeApp(__firebase_config);
            db = getFirestore(app);
            const firebaseAuth = getAuth(app);

            onAuthStateChanged(firebaseAuth, async (user) => {
                if (!user) {
                    try {
                        if (__initial_auth_token) {
                            await signInWithCustomToken(firebaseAuth, __initial_auth_token);
                        } else {
                            await signInAnonymously(firebaseAuth);
                        }
                    } catch (error) {
                        console.error("Firebase Auth Error:", error);
                    }
                }
                currentUserId = firebaseAuth.currentUser?.uid || crypto.randomUUID();
                document.getElementById('currentUserId').textContent = currentUserId;
                document.getElementById('userIdDisplay').classList.remove('hidden');
                isAuthReady = true;
                initFirebaseDataListeners(); // Initialize data listeners after auth is ready
            });
        } catch (error) {
            console.error("Failed to initialize Firebase:", error);
            isAuthReady = true; // Mark as ready even if init failed to unblock UI
        }

        // --- Data Definitions (from your React app) ---
        const services = [
            {
                id: 'pos-machine',
                name: "M√°y POS",
                description: "Gi·∫£i ph√°p thanh to√°n hi·ªán ƒë·∫°i, gi√∫p b·∫°n d·ªÖ d√†ng qu·∫£n l√Ω giao d·ªãch v√† t·ªëi ∆∞u h√≥a quy tr√¨nh b√°n h√†ng.",
                longDescription: "M√°y POS (Point of Sale) c·ªßa ch√∫ng t√¥i l√† thi·∫øt b·ªã thanh to√°n ti√™n ti·∫øn, cho ph√©p b·∫°n ch·∫•p nh·∫≠n thanh to√°n qua th·∫ª t√≠n d·ª•ng/ghi n·ª£, v√≠ ƒëi·ªán t·ª≠ m·ªôt c√°ch nhanh ch√≥ng v√† an to√†n. T√≠ch h·ª£p ph·∫ßn m·ªÅm qu·∫£n l√Ω b√°n h√†ng, m√°y POS gi√∫p b·∫°n theo d√µi doanh thu, qu·∫£n l√Ω kho h√†ng v√† in h√≥a ƒë∆°n t·ª©c th√¨, t·ªëi ∆∞u h√≥a quy tr√¨nh v·∫≠n h√†nh cho m·ªçi lo·∫°i h√¨nh kinh doanh t·ª´ c·ª≠a h√†ng nh·ªè ƒë·∫øn chu·ªói si√™u th·ªã. C√°c t√≠nh nƒÉng n·ªïi b·∫≠t: Qu·∫£n l√Ω giao d·ªãch, b√°o c√°o doanh thu, t√≠ch h·ª£p t·ªìn kho, h·ªó tr·ª£ ƒëa d·∫°ng ph∆∞∆°ng th·ª©c thanh to√°n.",
                imageUrl: "http://googleusercontent.com/image_generation_content/4",
                category: "Gi·∫£i ph√°p kinh doanh"
            },
            {
                id: 'tingbox',
                name: "Tingbox",
                description: "N√¢ng t·∫ßm tr·∫£i nghi·ªám kinh doanh c·ªßa b·∫°n v·ªõi thi·∫øt b·ªã ƒëa nƒÉng n√†y.",
                longDescription: "Tingbox l√† m·ªôt gi·∫£i ph√°p t·ªïng h·ª£p, cung c·∫•p c√°c t√≠nh nƒÉng qu·∫£n l√Ω kh√°ch h√†ng (CRM), t·ª± ƒë·ªông h√≥a marketing, v√† ph√¢n t√≠ch d·ªØ li·ªáu hi·ªáu qu·∫£. N√≥ gi√∫p doanh nghi·ªáp nh·ªè v√† v·ª´a d·ªÖ d√†ng ti·∫øp c·∫≠n c√¥ng ngh·ªá ƒë·ªÉ n√¢ng cao t∆∞∆°ng t√°c v·ªõi kh√°ch h√†ng, t·ªëi ∆∞u h√≥a chi·∫øn d·ªãch qu·∫£ng c√°o, v√† ƒë∆∞a ra quy·∫øt ƒë·ªãnh kinh doanh d·ª±a tr√™n d·ªØ li·ªáu ch√≠nh x√°c, t·ª´ ƒë√≥ th√∫c ƒë·∫©y tƒÉng tr∆∞·ªüng doanh thu. L·ª£i √≠ch: TƒÉng hi·ªáu su·∫•t, qu·∫£n l√Ω th√¥ng minh, ti·∫øt ki·ªám chi ph√≠, h·ªó tr·ª£ ƒëa n·ªÅn t·∫£ng.",
                imageUrl: "https://placehold.co/600x400/543d6b/fff?text=Tingbox",
                category: "Gi·∫£i ph√°p kinh doanh"
            },
            {
                id: 'credit-withdrawal',
                name: "R√∫t ti·ªÅn t√≠n d·ª•ng",
                description: "ƒê√°p ·ª©ng nhu c·∫ßu t√†i ch√≠nh c·∫•p b√°ch c·ªßa b·∫°n m·ªôt c√°ch nhanh ch√≥ng v√† an to√†n.",
                longDescription: "D·ªãch v·ª• r√∫t ti·ªÅn t√≠n d·ª•ng c·ªßa ch√∫ng t√¥i cho ph√©p b·∫°n nhanh ch√≥ng chuy·ªÉn ƒë·ªïi h·∫°n m·ª©c t√≠n d·ª•ng t·ª´ th·∫ª c·ªßa m√¨nh th√†nh ti·ªÅn m·∫∑t, ƒë√°p ·ª©ng c√°c nhu c·∫ßu chi ti√™u kh·∫©n c·∫•p. V·ªõi quy tr√¨nh ƒë∆°n gi·∫£n, b·∫£o m·∫≠t cao v√† m·ª©c ph√≠ c·∫°nh tranh, ch√∫ng t√¥i ƒë·∫£m b·∫£o b·∫°n c√≥ th·ªÉ ti·∫øp c·∫≠n ngu·ªìn v·ªën c·∫ßn thi·∫øt m√† kh√¥ng g·∫∑p tr·ªü ng·∫°i. ƒê·∫∑c ƒëi·ªÉm: Th·ªß t·ª•c ƒë∆°n gi·∫£n, gi·∫£i ng√¢n nhanh ch√≥ng, b·∫£o m·∫≠t th√¥ng tin, h·ªó tr·ª£ 24/7.",
                imageUrl: "http://googleusercontent.com/image_generation_content/6",
                category: "D·ªãch v·ª• t√†i ch√≠nh"
            },
            {
                id: 'consumer-loan-collateral',
                name: "Kho·∫£n vay ti√™u d√πng + th·∫ø ch·∫•p t√†i s·∫£n",
                description: "Gi·∫£i ph√°p t√†i ch√≠nh linh ho·∫°t, gi√∫p b·∫°n th·ª±c hi·ªán c√°c k·∫ø ho·∫°ch c√° nh√¢n ho·∫∑c kinh doanh v·ªõi s·ª± h·ªó tr·ª£ t·ª´ t√†i s·∫£n th·∫ø ch·∫•p.",
                longDescription: "Ch√∫ng t√¥i cung c·∫•p c√°c g√≥i vay ti√™u d√πng linh ho·∫°t, c√≥ ho·∫∑c kh√¥ng c√≥ t√†i s·∫£n th·∫ø ch·∫•p, ph√π h·ª£p v·ªõi m·ªçi nhu c·∫ßu t·ª´ mua s·∫Øm, h·ªçc t·∫≠p, ƒë·∫øn kh·ªüi nghi·ªáp. ƒê·∫∑c bi·ªát, v·ªõi c√°c kho·∫£n vay th·∫ø ch·∫•p t√†i s·∫£n (nh∆∞ nh√† ƒë·∫•t, xe h∆°i), b·∫°n c√≥ th·ªÉ ti·∫øp c·∫≠n h·∫°n m·ª©c vay l·ªõn h∆°n v·ªõi l√£i su·∫•t ∆∞u ƒë√£i, gi√∫p b·∫°n hi·ªán th·ª±c h√≥a c√°c k·∫ø ho·∫°ch t√†i ch√≠nh l·ªõn c·ªßa m√¨nh. ∆Øu ƒëi·ªÉm: L√£i su·∫•t c·∫°nh tranh, duy·ªát h·ªì s∆° nhanh, h·∫°n m·ª©c vay cao, th·ªùi gian tr·∫£ n·ª£ linh ho·∫°t.",
                imageUrl: "http://googleusercontent.com/image_generation_content/7",
                category: "D·ªãch v·ª• t√†i ch√≠nh"
            },
            {
                id: 'sim-card',
                name: "SIM s·ªë",
                description: "L·ª±a ch·ªçn SIM s·ªë ph√π h·ª£p v·ªõi phong th·ªßy, c√° t√≠nh ho·∫∑c nhu c·∫ßu kinh doanh c·ªßa b·∫°n.",
                longDescription: "Kho SIM s·ªë ƒëa d·∫°ng c·ªßa ch√∫ng t√¥i bao g·ªìm c√°c lo·∫°i SIM s·ªë ƒë·∫πp, SIM phong th·ªßy, SIM t·ª© qu√Ω, ng≈© qu√Ω, l·ªôc ph√°t, th·∫ßn t√†i v√† nhi·ªÅu lo·∫°i kh√°c, ph√π h·ª£p v·ªõi m·ªçi nhu c·∫ßu c√° nh√¢n hay kinh doanh. Ch√∫ng t√¥i cam k·∫øt cung c·∫•p SIM ch√≠nh ch·ªß, th·ªß t·ª•c nhanh g·ªçn, gi√∫p b·∫°n s·ªü h·ªØu s·ªë ƒëi·ªán tho·∫°i ∆∞ng √Ω v√† may m·∫Øn. L·ª±a ch·ªçn: SIM VIP, SIM phong th·ªßy, SIM theo y√™u c·∫ßu, h·ªó tr·ª£ ƒëƒÉng k√Ω ch√≠nh ch·ªß.",
                imageUrl: "http://googleusercontent.com/image_generation_content/8",
                category: "Vi·ªÖn th√¥ng & Ng√¢n h√†ng"
            },
            {
                id: 'bank-accounts',
                name: "T√†i kho·∫£n ng√¢n h√†ng OCB, BIDV",
                description: "M·ªü t√†i kho·∫£n ng√¢n h√†ng d·ªÖ d√†ng t·∫°i c√°c ng√¢n h√†ng uy t√≠n h√†ng ƒë·∫ßu nh∆∞ OCB, BIDV v√† nhi·ªÅu ng√¢n h√†ng kh√°c.",
                longDescription: "Ch√∫ng t√¥i h·ªó tr·ª£ kh√°ch h√†ng m·ªü t√†i kho·∫£n ng√¢n h√†ng t·∫°i c√°c t·ªï ch·ª©c t√†i ch√≠nh h√†ng ƒë·∫ßu nh∆∞ OCB, BIDV v√† nhi·ªÅu ng√¢n h√†ng uy t√≠n kh√°c. D·ªãch v·ª• bao g·ªìm t∆∞ v·∫•n ch·ªçn g√≥i t√†i kho·∫£n ph√π h·ª£p (ti·∫øt ki·ªám, thanh to√°n, ∆∞u ƒë√£i), h·ªó tr·ª£ th·ªß t·ª•c nhanh g·ªçn, v√† cung c·∫•p th√¥ng tin chi ti·∫øt v·ªÅ c√°c ti·ªán √≠ch nh∆∞ internet banking, mobile banking, th·∫ª thanh to√°n, ƒë·∫£m b·∫£o s·ª± ti·ªán l·ª£i t·ªëi ƒëa cho b·∫°n. Ti·ªán √≠ch: Internet Banking, Mobile Banking, Th·∫ª ATM/Visa/MasterCard, ∆∞u ƒë√£i ph√≠ giao d·ªãch.",
                imageUrl: "http://googleusercontent.com/image_generation_content/0",
                category: "Vi·ªÖn th√¥ng & Ng√¢n h√†ng"
            },
            {
                id: 'phone-accessories',
                name: "Ph·ª• ki·ªán ƒëi·ªán tho·∫°i",
                description: "ƒêa d·∫°ng ph·ª• ki·ªán ch·∫•t l∆∞·ª£ng cao, b·∫£o v·ªá v√† n√¢ng cao tr·∫£i nghi·ªám s·ª≠ d·ª•ng ƒëi·ªán tho·∫°i c·ªßa b·∫°n.",
                longDescription: "Ch√∫ng t√¥i cung c·∫•p ƒë·∫ßy ƒë·ªß c√°c lo·∫°i ph·ª• ki·ªán ƒëi·ªán tho·∫°i ch√≠nh h√£ng v√† ch·∫•t l∆∞·ª£ng cao nh∆∞ ·ªëp l∆∞ng, k√≠nh c∆∞·ªùng l·ª±c, s·∫°c d·ª± ph√≤ng, tai nghe, c√°p s·∫°c, g·∫≠y selfie... C√°c s·∫£n ph·∫©m ƒë∆∞·ª£c l·ª±a ch·ªçn k·ªπ l∆∞·ª°ng, ƒë·∫£m b·∫£o ƒë·ªô b·ªÅn v√† t√≠nh t∆∞∆°ng th√≠ch cao, gi√∫p b·∫£o v·ªá thi·∫øt b·ªã v√† t·ªëi ∆∞u h√≥a tr·∫£i nghi·ªám s·ª≠ d·ª•ng c·ªßa b·∫°n. S·∫£n ph·∫©m: ·ªêp l∆∞ng, k√≠nh c∆∞·ªùng l·ª±c, s·∫°c d·ª± ph√≤ng, tai nghe, c√°p s·∫°c, thi·∫øt b·ªã Bluetooth.",
                imageUrl: "http://googleusercontent.com/image_generation_content/2",
                category: "Thi·∫øt b·ªã ƒëi·ªán t·ª≠"
            },
            {
                id: 'smartphones',
                name: "ƒêi·ªán tho·∫°i",
                description: "Cung c·∫•p c√°c d√≤ng ƒëi·ªán tho·∫°i m·ªõi nh·∫•t, ƒë√°p ·ª©ng m·ªçi nhu c·∫ßu t·ª´ h·ªçc t·∫≠p, l√†m vi·ªác ƒë·∫øn gi·∫£i tr√≠.",
                longDescription: "Ch√∫ng t√¥i l√† ƒë·ªëi t√°c c·ªßa c√°c th∆∞∆°ng hi·ªáu ƒëi·ªán tho·∫°i h√†ng ƒë·∫ßu th·∫ø gi·ªõi, mang ƒë·∫øn cho b·∫°n nh·ªØng m·∫´u smartphone m·ªõi nh·∫•t v·ªõi ƒëa d·∫°ng c·∫•u h√¨nh, t√≠nh nƒÉng v√† m·ª©c gi√°. T·ª´ ƒëi·ªán tho·∫°i ph·ªï th√¥ng ƒë·∫øn c√°c d√≤ng cao c·∫•p, ch√∫ng t√¥i ƒë·∫£m b·∫£o cung c·∫•p s·∫£n ph·∫©m ch√≠nh h√£ng, b·∫£o h√†nh uy t√≠n v√† d·ªãch v·ª• h·∫≠u m√£i chu ƒë√°o. Th∆∞∆°ng hi·ªáu: Samsung, iPhone, Oppo, Xiaomi, Vivo. M·∫´u m√£ ƒëa d·∫°ng, b·∫£o h√†nh ch√≠nh h√£ng.",
                imageUrl: "http://googleusercontent.com/image_generation_content/9",
                category: "Thi·∫øt b·ªã ƒëi·ªán t·ª≠"
            },
            {
                id: 'laptops',
                name: "Laptop",
                description: "Cung c·∫•p c√°c d√≤ng laptop m·ªõi nh·∫•t, ƒë√°p ·ª©ng m·ªçi nhu c·∫ßu t·ª´ h·ªçc t·∫≠p, l√†m vi·ªác ƒë·∫øn gi·∫£i tr√≠.",
                longDescription: "C·ª≠a h√†ng ch√∫ng t√¥i chuy√™n cung c·∫•p c√°c lo·∫°i laptop t·ª´ vƒÉn ph√≤ng, h·ªçc t·∫≠p ƒë·∫øn gaming, ƒë·ªì h·ªça, t·ª´ c√°c th∆∞∆°ng hi·ªáu uy t√≠n. M·ªói chi·∫øc laptop ƒë·ªÅu ƒë∆∞·ª£c ki·ªÉm tra k·ªπ l∆∞·ª°ng v·ªÅ ch·∫•t l∆∞·ª£ng, hi·ªáu nƒÉng v√† ƒë∆∞·ª£c b·∫£o h√†nh ch√≠nh h√£ng. Ch√∫ng t√¥i cam k·∫øt mang ƒë·∫øn cho b·∫°n s·∫£n ph·∫©m ph√π h·ª£p nh·∫•t v·ªõi nhu c·∫ßu v√† ng√¢n s√°ch, c√πng v·ªõi d·ªãch v·ª• h·ªó tr·ª£ k·ªπ thu·∫≠t t·∫≠n t√¨nh. Lo·∫°i h√¨nh: Laptop vƒÉn ph√≤ng, gaming, ƒë·ªì h·ªça, si√™u m·ªèng nh·∫π. C·∫•u h√¨nh ƒëa d·∫°ng, b·∫£o h√†nh d√†i h·∫°n.",
                imageUrl: "http://googleusercontent.com/image_generation_content/10",
                category: "Thi·∫øt b·ªã ƒëi·ªán t·ª≠"
            },
            {
                id: 'car-sales',
                name: "B√°n Xe H∆°i",
                description: "H·ªó tr·ª£ t√¨m ki·∫øm v√† s·ªü h·ªØu chi·∫øc xe h∆°i ∆∞ng √Ω.",
                longDescription: "D·ªãch v·ª• b√°n xe h∆°i c·ªßa ch√∫ng t√¥i bao g·ªìm t∆∞ v·∫•n l·ª±a ch·ªçn xe ph√π h·ª£p v·ªõi nhu c·∫ßu v√† ng√¢n s√°ch, h·ªó tr·ª£ th·ªß t·ª•c mua b√°n, ƒëƒÉng k√Ω xe, v√† c√°c d·ªãch v·ª• h·∫≠u m√£i. Ch√∫ng t√¥i cung c·∫•p ƒëa d·∫°ng c√°c d√≤ng xe t·ª´ xe ƒë√£ qua s·ª≠ d·ª•ng ƒë·∫øn xe m·ªõi, ƒë·∫£m b·∫£o ngu·ªìn g·ªëc r√µ r√†ng, ch·∫•t l∆∞·ª£ng ƒë∆∞·ª£c ki·ªÉm ƒë·ªãnh, gi√∫p b·∫°n an t√¢m s·ªü h·ªØu chi·∫øc xe m∆° ∆∞·ªõc. D·ªãch v·ª•: T∆∞ v·∫•n mua xe, h·ªó tr·ª£ vay mua xe, ƒëƒÉng k√Ω, ƒëƒÉng ki·ªÉm, b·∫£o d∆∞·ª°ng sau b√°n.",
                imageUrl: "http://googleusercontent.com/image_generation_content/1",
                category: "Kh√°c"
            }
        ];

        const categoryBannerImages = {
            'T·∫•t c·∫£': 'https://placehold.co/1920x600/a3e635/1c1c1c?text=Dich+Vu+Tong+Hop',
            'Gi·∫£i ph√°p kinh doanh': 'https://placehold.co/1920x600/fcd34d/1c1c1c?text=Giai+Phap+Kinh+Doanh',
            'D·ªãch v·ª• t√†i ch√≠nh': 'https://placehold.co/1920x600/60a5fa/1c1c1c?text=Dich+Vu+Tai+Chinh',
            'Vi·ªÖn th√¥ng & Ng√¢n h√†ng': 'https://placehold.co/1920x600/8b5cf6/1c1c1c?text=Vien+Thong+Ngan+Hang',
            'Thi·∫øt b·ªã ƒëi·ªán t·ª≠': 'https://placehold.co/1920x600/ef4444/1c1c1c?text=Thiet+Bi+Dien+Tu',
            'Kh√°c': 'https://placehold.co/1920x600/34d399/1c1c1c?text=Dich+Vu+Khac',
        };

        const faqs = [
            {
                id: 'faq1',
                question: "Th·ªùi gian l√†m vi·ªác c·ªßa c√°c b·∫°n l√† khi n√†o?",
                answer: "Ch√∫ng t√¥i ho·∫°t ƒë·ªông t·ª´ Th·ª© Hai ƒë·∫øn Th·ª© B·∫£y, t·ª´ 8:00 s√°ng ƒë·∫øn 17:00 chi·ªÅu. Vui l√≤ng li√™n h·ªá ƒë·ªÉ ƒë·∫∑t l·ªãch h·∫πn ngo√†i gi·ªù n·∫øu c·∫ßn."
            },
            {
                id: 'faq2',
                question: "T√¥i c√≥ th·ªÉ thanh to√°n b·∫±ng nh·ªØng h√¨nh th·ª©c n√†o?",
                answer: "Ch√∫ng t√¥i ch·∫•p nh·∫≠n thanh to√°n b·∫±ng ti·ªÅn m·∫∑t, chuy·ªÉn kho·∫£n ng√¢n h√†ng, v√† thanh to√°n qua m√°y POS b·∫±ng th·∫ª t√≠n d·ª•ng/ghi n·ª£."
            },
            {
                id: 'faq3',
                question: "Ch√≠nh s√°ch b·∫£o h√†nh v√† ƒë·ªïi tr·∫£ d·ªãch v·ª•/s·∫£n ph·∫©m nh∆∞ th·∫ø n√†o?",
                answer: "M·ªói d·ªãch v·ª• v√† s·∫£n ph·∫©m s·∫Ω c√≥ ch√≠nh s√°ch b·∫£o h√†nh/ƒë·ªïi tr·∫£ ri√™ng bi·ªát, ƒë∆∞·ª£c t∆∞ v·∫•n chi ti·∫øt khi qu√Ω kh√°ch s·ª≠ d·ª•ng d·ªãch v·ª• ho·∫∑c mua s·∫£n ph·∫©m. Ch√∫ng t√¥i cam k·∫øt h·ªó tr·ª£ t·ªët nh·∫•t cho kh√°ch h√†ng."
            },
            {
                id: 'faq4',
                question: "L√†m th·∫ø n√†o ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n v·ªÅ kho·∫£n vay ti√™u d√πng?",
                answer: "Qu√Ω kh√°ch c√≥ th·ªÉ li√™n h·ªá tr·ª±c ti·∫øp qua s·ªë ƒëi·ªán tho·∫°i 0363.79.89.89 (g·∫∑p Hi·∫øu) ho·∫∑c ƒëi·ªÅn v√†o form li√™n h·ªá tr√™n trang web ƒë·ªÉ nh·∫≠n ƒë∆∞·ª£c t∆∞ v·∫•n chi ti·∫øt t·ª´ chuy√™n vi√™n c·ªßa ch√∫ng t√¥i."
            }
        ];

        const processSteps = [
            {
                id: 'step1',
                title: "B∆∞·ªõc 1: Li√™n h·ªá & T∆∞ v·∫•n",
                description: "Qu√Ω kh√°ch li√™n h·ªá qua hotline ho·∫∑c form, ch√∫ng t√¥i s·∫Ω l·∫Øng nghe nhu c·∫ßu v√† ƒë∆∞a ra t∆∞ v·∫•n ph√π h·ª£p."
            },
            {
                id: 'step2',
                title: "B∆∞·ªõc 2: Gi·∫£i ph√°p & ƒê·ªÅ xu·∫•t",
                description: "Ch√∫ng t√¥i ƒë·ªÅ xu·∫•t c√°c s·∫£n ph·∫©m/d·ªãch v·ª• t·ªëi ∆∞u, k√®m theo b√°o gi√° v√† th√¥ng tin chi ti·∫øt."
            },
            {
                id: "step3",
                title: "B∆∞·ªõc 3: Tri·ªÉn khai & H·ªó tr·ª£",
                description: "Ti·∫øn h√†nh tri·ªÉn khai d·ªãch v·ª•/giao s·∫£n ph·∫©m v√† lu√¥n ƒë·ªìng h√†nh h·ªó tr·ª£ qu√Ω kh√°ch trong su·ªët qu√° tr√¨nh s·ª≠ d·ª•ng."
            }
        ];

        // --- Application State and Logic (using vanilla JS) ---
        let activeCategory = 'T·∫•t c·∫£';
        let searchTerm = '';
        let selectedService = null;
        let isAIChatOpen = false;
        let isComparisonModalOpen = false;
        let openFaqId = null;
        let isNavOpen = false; // For mobile hamburger menu

        let generatedServiceBenefits = null;
        let isGeneratingBenefits = false;
        let specificServiceQuestion = '';
        let specificServiceAnswer = null;
        let isAskingSpecificService = false;

        let testimonials = []; // Will be populated from Firestore

        // Utility functions for UI updates
        function showElement(id) { document.getElementById(id)?.classList.remove('hidden'); }
        function hideElement(id) { document.getElementById(id)?.classList.add('hidden'); }
        function setButtonLoading(buttonId, spinnerId, textId, loadingText, originalText, isLoading) {
            const button = document.getElementById(buttonId);
            const spinner = document.getElementById(spinnerId);
            const text = document.getElementById(textId);
            if (button && spinner && text) {
                button.disabled = isLoading;
                if (isLoading) {
                    spinner.classList.remove('hidden');
                    text.textContent = loadingText;
                } else {
                    spinner.classList.add('hidden');
                    text.textContent = originalText;
                }
            }
        }

        // --- Render Functions ---

        function renderServices() {
            const servicesGrid = document.getElementById('services-grid');
            servicesGrid.innerHTML = ''; // Clear previous services

            const filteredServices = services.filter(service => {
                const matchesCategory = activeCategory === 'T·∫•t c·∫£' || service.category === activeCategory;
                const matchesSearch = service.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                      service.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                      service.longDescription.toLowerCase().includes(searchTerm.toLowerCase());
                return matchesCategory && matchesSearch;
            });

            if (filteredServices.length === 0) {
                servicesGrid.innerHTML = '<p class="col-span-full text-center text-xl text-gray-600 py-10">Kh√¥ng t√¨m th·∫•y d·ªãch v·ª• n√†o ph√π h·ª£p v·ªõi t√¨m ki·∫øm c·ªßa b·∫°n.</p>';
                return;
            }

            filteredServices.forEach(service => {
                const serviceCard = document.createElement('div');
                serviceCard.className = "bg-white rounded-2xl shadow-xl hover:shadow-2xl transform hover:-translate-y-2 transition duration-300 ease-in-out overflow-hidden flex flex-col cursor-pointer border border-gray-100";
                serviceCard.onclick = () => openServiceModal(service);

                serviceCard.innerHTML = `
                    <div class="w-full h-56 md:h-64 overflow-hidden rounded-t-2xl bg-gray-200">
                        <img src="${service.imageUrl}" alt="${service.name}" class="w-full h-full object-cover transition-transform duration-300 hover:scale-110" onerror="this.onerror=null; this.src='https://placehold.co/600x400/cccccc/333333?text=${encodeURIComponent(service.name)}';" />
                    </div>
                    <div class="p-6 flex-grow flex flex-col justify-between">
                        <h2 class="text-2xl font-bold text-gray-900 mb-3">${service.name}</h2>
                        <p class="text-gray-600 leading-relaxed flex-grow text-base">${service.description}</p>
                        <button class="mt-6 px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-700 text-white rounded-full hover:from-indigo-700 hover:to-purple-800 transition-all duration-300 shadow-lg self-start text-base font-semibold" aria-label="Xem chi ti·∫øt d·ªãch v·ª• ${service.name}">
                            Xem chi ti·∫øt
                        </button>
                    </div>
                `;
                servicesGrid.appendChild(serviceCard);
            });
        }

        function renderCategoriesNav() {
            const categoryNav = document.getElementById('category-nav');
            categoryNav.innerHTML = ''; // Clear existing buttons
            const categories = ['T·∫•t c·∫£', ...new Set(services.map(service => service.category))];

            categories.forEach(category => {
                const li = document.createElement('li');
                li.className = isNavOpen ? 'w-full text-center' : '';
                const button = document.createElement('button');
                button.textContent = category;
                button.className = `
                    px-6 py-3 rounded-full text-base font-semibold w-full
                    transition-all duration-300 ease-in-out
                    ${activeCategory === category
                        ? 'bg-gradient-to-r from-indigo-600 to-purple-700 text-white shadow-lg transform scale-105'
                        : 'bg-gray-100 text-gray-700 hover:bg-gray-200 hover:text-indigo-700'
                    }
                    focus:outline-none focus:ring-4 focus:ring-indigo-300 focus:ring-opacity-75
                `;
                button.setAttribute('aria-current', activeCategory === category ? 'page' : 'false');
                button.onclick = () => handleCategoryChange(category);
                li.appendChild(button);
                categoryNav.appendChild(li);
            });
            // Update visibility of the category nav for mobile
            if (isNavOpen) {
                categoryNav.classList.remove('hidden');
            } else {
                categoryNav.classList.add('hidden');
            }

            // Update hamburger icon
            const navToggleIcon = document.getElementById('nav-toggle-icon');
            if (navToggleIcon) {
                if (isNavOpen) {
                    navToggleIcon.setAttribute('d', "M6 18L18 6M6 6l12 12");
                } else {
                    navToggleIcon.setAttribute('d', "M4 6h16M4 12h16M4 18h16");
                }
            }
        }

        function renderCategoryBanner() {
            const categoryBanner = document.getElementById('category-banner');
            const categoryBannerImg = document.getElementById('category-banner-img');

            if (activeCategory && categoryBannerImages[activeCategory]) {
                categoryBannerImg.src = categoryBannerImages[activeCategory];
                showElement('category-banner');
            } else {
                hideElement('category-banner');
            }
        }

        function renderProcessSteps() {
            const processStepsGrid = document.getElementById('process-steps-grid');
            processStepsGrid.innerHTML = '';
            processSteps.forEach(step => {
                const stepDiv = document.createElement('div');
                stepDiv.className = "flex flex-col items-center p-4 rounded-xl transition-transform duration-300 hover:scale-105";
                stepDiv.innerHTML = `
                    <div class="w-20 h-20 bg-indigo-500 text-white rounded-full flex items-center justify-center text-3xl font-extrabold mb-5 shadow-md">
                        ${step.id.replace('step', '')}
                    </div>
                    <h3 class="text-2xl font-semibold text-gray-900 mb-3">${step.title}</h3>
                    <p class="text-gray-700 leading-relaxed text-base">${step.description}</p>
                `;
                processStepsGrid.appendChild(stepDiv);
            });
        }

        function renderTestimonials() {
            const testimonialsGrid = document.getElementById('testimonials-grid');
            testimonialsGrid.innerHTML = ''; // Clear previous content
            if (testimonials.length > 0) {
                testimonials.forEach(testimonial => {
                    const testimonialCard = document.createElement('div');
                    testimonialCard.className = "bg-white text-gray-800 p-6 rounded-xl shadow-lg flex flex-col justify-between border-b-4 border-indigo-300 transform transition-transform duration-300 hover:scale-[1.02]";
                    testimonialCard.innerHTML = `
                        <p class="italic text-lg mb-4 leading-relaxed">"${testimonial.quote}"</p>
                        <div>
                            <p class="font-bold text-indigo-700 text-lg">${testimonial.customerName}</p>
                            <p class="text-sm text-gray-600">${testimonial.title}</p>
                        </div>
                    `;
                    testimonialsGrid.appendChild(testimonialCard);
                });
            } else {
                testimonialsGrid.innerHTML = '<p class="col-span-full text-center text-white opacity-80 text-xl py-10">ƒêang t·∫£i ƒë√°nh gi√° kh√°ch h√†ng...</p>';
            }
        }

        function renderFAQs() {
            const faqList = document.getElementById('faq-list');
            faqList.innerHTML = '';
            faqs.forEach(faq => {
                const faqItem = document.createElement('div');
                faqItem.className = "border border-gray-200 rounded-lg overflow-hidden shadow-sm transition-all duration-300 hover:shadow-md";
                faqItem.innerHTML = `
                    <button
                        class="flex justify-between items-center w-full p-5 text-left font-semibold text-xl text-gray-800 bg-gray-50 hover:bg-gray-100 transition-colors duration-200 focus:outline-none"
                        aria-expanded="${openFaqId === faq.id ? 'true' : 'false'}"
                        aria-controls="faq-answer-${faq.id}"
                        data-faq-id="${faq.id}"
                    >
                        <span>${faq.question}</span>
                        <svg
                            class="w-6 h-6 transition-transform duration-200 ${openFaqId === faq.id ? 'rotate-180 text-indigo-600' : 'text-gray-500'}"
                            fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <div id="faq-answer-${faq.id}" role="region" class="p-5 bg-white border-t border-gray-200 animate-fadeInContent ${openFaqId === faq.id ? '' : 'hidden'}">
                        <p class="text-gray-700 text-lg">${faq.answer}</p>
                    </div>
                `;
                faqList.appendChild(faqItem);
            });

            // Attach click listeners to FAQ buttons dynamically
            faqList.querySelectorAll('button[data-faq-id]').forEach(button => {
                button.onclick = (event) => toggleFaq(event.currentTarget.dataset.faqId);
            });
        }


        // --- Event Handlers ---

        document.getElementById('heroContactButton').addEventListener('click', () => {
            document.getElementById('contact-form-section').scrollIntoView({ behavior: 'smooth' });
        });

        document.getElementById('search-input').addEventListener('input', (event) => {
            searchTerm = event.target.value;
            selectedService = null; // Clear selected service on search
            generatedServiceBenefits = null;
            isGeneratingBenefits = false;
            specificServiceQuestion = '';
            specificServiceAnswer = null;
            isAskingSpecificService = false;
            renderServices();
        });

        document.getElementById('nav-toggle').addEventListener('click', () => {
            isNavOpen = !isNavOpen;
            renderCategoriesNav();
        });

        window.addEventListener('scroll', () => {
            const show = window.pageYOffset > 300;
            if (show) {
                showElement('scroll-to-top-button');
            } else {
                hideElement('scroll-to-top-button');
            }
        });

        document.getElementById('scroll-to-top-button').addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        document.getElementById('contact-form').addEventListener('submit', async (event) => {
            event.preventDefault();
            const formFeedback = document.getElementById('form-feedback');
            formFeedback.textContent = ''; // Clear previous feedback

            if (!db || !currentUserId || !canvasAppId) {
                formFeedback.textContent = 'L·ªói: H·ªá th·ªëng ch∆∞a s·∫µn s√†ng. Vui l√≤ng th·ª≠ l·∫°i sau.';
                formFeedback.classList.remove('text-green-600', 'hidden');
                formFeedback.classList.add('text-red-600');
                return;
            }

            const contactName = document.getElementById('contactName').value;
            const contactEmail = document.getElementById('contactEmail').value;
            const contactPhone = document.getElementById('contactPhone').value;
            const contactMessage = document.getElementById('contactMessage').value;

            if (!contactName || !contactEmail || !contactMessage) {
                formFeedback.textContent = 'Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß H·ªç v√† T√™n, Email, v√† Tin nh·∫Øn.';
                formFeedback.classList.remove('text-green-600', 'hidden');
                formFeedback.classList.add('text-red-600');
                return;
            }

            try {
                await addDoc(collection(db, `artifacts/${canvasAppId}/public/data/contact_forms`), {
                    userId: currentUserId,
                    name: contactName,
                    email: contactEmail,
                    phone: contactPhone,
                    message: contactMessage,
                    timestamp: serverTimestamp(),
                });
                formFeedback.textContent = 'Y√™u c·∫ßu c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c g·ª≠i th√†nh c√¥ng! Ch√∫ng t√¥i s·∫Ω li√™n h·ªá l·∫°i s·ªõm nh·∫•t.';
                formFeedback.classList.remove('text-red-600', 'hidden');
                formFeedback.classList.add('text-green-600');
                // Clear form fields
                document.getElementById('contactName').value = '';
                document.getElementById('contactEmail').value = '';
                document.getElementById('contactPhone').value = '';
                document.getElementById('contactMessage').value = '';
            } catch (error) {
                console.error("Error submitting contact form: ", error);
                formFeedback.textContent = 'ƒê√£ x·∫£y ra l·ªói khi g·ª≠i y√™u c·∫ßu. Vui l√≤ng th·ª≠ l·∫°i.';
                formFeedback.classList.remove('text-green-600', 'hidden');
                formFeedback.classList.add('text-red-600');
            }
            showElement('form-feedback');
        });

        // --- Core Logic Functions ---

        function handleCategoryChange(category) {
            activeCategory = category;
            searchTerm = ''; // Clear search term on category change
            selectedService = null;
            generatedServiceBenefits = null;
            isGeneratingBenefits = false;
            specificServiceQuestion = '';
            specificServiceAnswer = null;
            isAskingSpecificService = false;

            hideElement('loading-spinner'); // Ensure spinner is not showing initially
            showElement('loading-spinner'); // Show spinner for category change
            document.getElementById('services-grid').innerHTML = ''; // Clear grid

            setTimeout(() => {
                renderCategoryBanner();
                renderServices();
                hideElement('loading-spinner'); // Hide spinner after rendering
                window.scrollTo({ top: 0, behavior: 'smooth' });
                if (window.innerWidth <= 767) { // Below md breakpoint
                    isNavOpen = false;
                    renderCategoriesNav(); // Close mobile nav
                }
            }, 300); // Small delay for effect
        }

        function openServiceModal(service) {
            selectedService = service;
            document.getElementById('modal-service-name').textContent = service.name;
            document.getElementById('modal-service-image').src = service.imageUrl;
            document.getElementById('modal-service-image').alt = service.name;
            document.getElementById('modal-service-long-description').innerHTML = service.longDescription;

            // Reset AI related fields in modal
            generatedServiceBenefits = null;
            isGeneratingBenefits = false;
            specificServiceQuestion = '';
            specificServiceAnswer = null;
            isAskingSpecificService = false;
            hideElement('generated-benefits-container');
            hideElement('specific-service-answer-container');
            document.getElementById('specific-service-question-input').value = '';

            showElement('service-detail-modal');
        }

        function closeServiceModal() {
            selectedService = null;
            hideElement('service-detail-modal');
            generatedServiceBenefits = null;
            isGeneratingBenefits = false;
            specificServiceQuestion = '';
            specificServiceAnswer = null;
            isAskingSpecificService = false;
            hideElement('generated-benefits-container');
            hideElement('specific-service-answer-container');
            document.getElementById('specific-service-question-input').value = '';
        }

        async function generateKeyBenefits(longDescription) {
            isGeneratingBenefits = true;
            setButtonLoading('generate-benefits-button', 'generate-benefits-spinner', 'generate-benefits-text', 'ƒêang t·∫°o...', '‚ú® G·ª£i √Ω L·ª£i √≠ch ch√≠nh ‚ú®', true);
            hideElement('generated-benefits-container');
            generatedServiceBenefits = null;

            const llmPrompt = `D·ª±a tr√™n m√¥ t·∫£ d·ªãch v·ª• sau, h√£y li·ªát k√™ 3 ƒë·∫øn 5 l·ª£i √≠ch ch√≠nh c·ªßa d·ªãch v·ª• n√†y, d∆∞·ªõi d·∫°ng danh s√°ch g·∫°ch ƒë·∫ßu d√≤ng (bullet points). Ch·ªâ bao g·ªìm c√°c l·ª£i √≠ch v√† kh√¥ng th√™m b·∫•t k·ª≥ vƒÉn b·∫£n gi·ªõi thi·ªáu hay k·∫øt lu·∫≠n n√†o.
                M√¥ t·∫£ d·ªãch v·ª•:
                "${longDescription}"
            `;

            try {
                const payload = {
                    contents: [{ role: "user", parts: [{ text: llmPrompt }] }],
                    generationConfig: {
                        temperature: 0.5,
                        topP: 0.9,
                        topK: 20,
                    },
                };

                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    generatedServiceBenefits = text;
                    document.getElementById('generated-benefits-content').innerHTML = text.replace(/\n/g, '<br/>');
                    showElement('generated-benefits-container');
                } else {
                    generatedServiceBenefits = 'Kh√¥ng th·ªÉ t·∫°o l·ª£i √≠ch ch√≠nh l√∫c n√†y. Vui l√≤ng th·ª≠ l·∫°i.';
                    document.getElementById('generated-benefits-content').textContent = generatedServiceBenefits;
                    showElement('generated-benefits-container');
                }
            } catch (error) {
                console.error('Error calling Gemini API for benefits:', error);
                generatedServiceBenefits = 'ƒê√£ x·∫£y ra l·ªói khi t·∫°o l·ª£i √≠ch. Vui l√≤ng th·ª≠ l·∫°i.';
                document.getElementById('generated-benefits-content').textContent = generatedServiceBenefits;
                showElement('generated-benefits-container');
            } finally {
                isGeneratingBenefits = false;
                setButtonLoading('generate-benefits-button', 'generate-benefits-spinner', 'generate-benefits-text', 'ƒêang t·∫°o...', '‚ú® G·ª£i √Ω L·ª£i √≠ch ch√≠nh ‚ú®', false);
            }
        }

        async function askAboutSpecificService(serviceLongDescription, question) {
            if (!question.trim()) {
                specificServiceAnswer = 'Vui l√≤ng nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n.';
                document.getElementById('specific-service-answer-content').textContent = specificServiceAnswer;
                showElement('specific-service-answer-container');
                return;
            }

            isAskingSpecificService = true;
            setButtonLoading('ask-specific-service-button', 'ask-specific-service-spinner', 'ask-specific-service-text', 'ƒêang h·ªèi...', 'H·ªèi AI', true);
            hideElement('specific-service-answer-container');
            specificServiceAnswer = null;

            const llmPrompt = `D·ª±a tr√™n m√¥ t·∫£ d·ªãch v·ª• sau, h√£y tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng. N·∫øu th√¥ng tin kh√¥ng c√≥ trong m√¥ t·∫£, h√£y n√≥i r√µ r·∫±ng b·∫°n kh√¥ng t√¨m th·∫•y th√¥ng tin n√†y trong vƒÉn b·∫£n cung c·∫•p.

            M√¥ t·∫£ d·ªãch v·ª•:
            "${serviceLongDescription}"

            C√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng: "${question}"

            Tr·∫£ l·ªùi:
            `;

            try {
                const payload = {
                    contents: [{ role: "user", parts: [{ text: llmPrompt }] }],
                    generationConfig: {
                        temperature: 0.2,
                        topP: 0.8,
                        topK: 10,
                    },
                };

                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    specificServiceAnswer = text;
                    document.getElementById('specific-service-answer-content').textContent = text;
                    showElement('specific-service-answer-container');
                } else {
                    specificServiceAnswer = 'Kh√¥ng th·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi c·ªßa b·∫°n l√∫c n√†y. Vui l√≤ng th·ª≠ l·∫°i.';
                    document.getElementById('specific-service-answer-content').textContent = specificServiceAnswer;
                    showElement('specific-service-answer-container');
                }
            } catch (error) {
                console.error('Error calling Gemini API for specific service question:', error);
                specificServiceAnswer = 'ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω c√¢u h·ªèi. Vui l√≤ng th·ª≠ l·∫°i.';
                document.getElementById('specific-service-answer-content').textContent = specificServiceAnswer;
                showElement('specific-service-answer-container');
            } finally {
                isAskingSpecificService = false;
                setButtonLoading('ask-specific-service-button', 'ask-specific-service-spinner', 'ask-specific-service-text', 'ƒêang h·ªèi...', 'H·ªèi AI', false);
            }
        }

        function toggleFaq(id) {
            openFaqId = (openFaqId === id ? null : id);
            renderFAQs(); // Re-render FAQs to update expanded state
        }

        // --- Modals Logic ---
        document.getElementById('open-ai-chat-button').addEventListener('click', () => {
            isAIChatOpen = true;
            showElement('ai-chat-modal');
            document.getElementById('ai-chat-history').innerHTML = ''; // Clear chat history
            document.getElementById('ai-user-input').value = '';
        });
        document.getElementById('close-ai-chat-modal').addEventListener('click', () => {
            isAIChatOpen = false;
            hideElement('ai-chat-modal');
        });

        document.getElementById('open-comparison-modal-button').addEventListener('click', () => {
            isComparisonModalOpen = true;
            showElement('service-comparison-modal');
            populateComparisonSelects();
            document.getElementById('comparison-result-container').classList.add('hidden'); // Hide result
            document.getElementById('comparison-result-content').textContent = ''; // Clear content
            document.getElementById('comparison-error-message').classList.add('hidden'); // Hide error
        });
        document.getElementById('close-comparison-modal').addEventListener('click', () => {
            isComparisonModalOpen = false;
            hideElement('service-comparison-modal');
        });

        // Event listener for modal buttons
        document.getElementById('close-service-modal').addEventListener('click', closeServiceModal);
        document.getElementById('close-service-modal-bottom').addEventListener('click', closeServiceModal);
        document.getElementById('generate-benefits-button').addEventListener('click', () => {
            if (selectedService) {
                generateKeyBenefits(selectedService.longDescription);
            }
        });
        document.getElementById('ask-specific-service-button').addEventListener('click', () => {
            if (selectedService) {
                const question = document.getElementById('specific-service-question-input').value;
                askAboutSpecificService(selectedService.longDescription, question);
            }
        });
        document.getElementById('specific-service-question-input').addEventListener('keypress', (event) => {
            if (event.key === 'Enter' && selectedService) {
                const question = document.getElementById('specific-service-question-input').value;
                askAboutSpecificService(selectedService.longDescription, question);
            }
        });


        // AI Chat Assistant Logic
        document.getElementById('ai-send-message-button').addEventListener('click', handleAIChatSendMessage);
        document.getElementById('ai-user-input').addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                handleAIChatSendMessage();
            }
        });

        let aiChatHistory = [];
        let isAIChatGenerating = false;

        async function handleAIChatSendMessage() {
            const userInput = document.getElementById('ai-user-input').value.trim();
            if (!userInput || isAIChatGenerating) return;

            isAIChatGenerating = true;
            document.getElementById('ai-user-input').disabled = true;
            document.getElementById('ai-send-message-button').disabled = true;

            aiChatHistory.push({ role: "user", parts: [{ text: userInput }] });
            appendMessageToAIChat('user', userInput);
            document.getElementById('ai-user-input').value = ''; // Clear input

            appendMessageToAIChat('model', '<div class="text-center text-gray-500 italic">AI ƒëang suy nghƒ©...</div>', true); // Show thinking indicator

            // Prepare service data for the LLM
            const serviceDataForLLM = services.map(s => `- T√™n: ${s.name}, M√¥ t·∫£: ${s.description}, Danh m·ª•c: ${s.category}`).join('\n');

            const llmPrompt = `B·∫°n l√† m·ªôt tr·ª£ l√Ω ·∫£o am hi·ªÉu v·ªÅ c√°c d·ªãch v·ª• sau ƒë√¢y. D·ª±a tr√™n m√¥ t·∫£ c·ªßa ng∆∞·ªùi d√πng, h√£y g·ª£i √Ω c√°c d·ªãch v·ª• ph√π h·ª£p nh·∫•t v√† gi·∫£i th√≠ch ng·∫Øn g·ªçn t·∫°i sao. N·∫øu kh√¥ng c√≥ d·ªãch v·ª• n√†o ph√π h·ª£p, h√£y th√¥ng b√°o cho ng∆∞·ªùi d√πng.
                C√°c d·ªãch v·ª• c·ªßa ch√∫ng t√¥i:
                ${serviceDataForLLM} 

                Nhu c·∫ßu c·ªßa ng∆∞·ªùi d√πng: "${userInput}"
                G·ª£i √Ω c·ªßa b·∫°n:
            `;

            try {
                const payload = {
                    contents: [{ role: "user", parts: [{ text: llmPrompt }] }],
                    generationConfig: {
                        temperature: 0.7,
                        topP: 0.95,
                        topK: 40,
                    },
                };

                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                removeThinkingIndicator(); // Remove thinking indicator before appending actual response

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    aiChatHistory.push({ role: 'model', parts: [{ text: text }] });
                    appendMessageToAIChat('model', text);
                } else {
                    aiChatHistory.push({ role: 'model', parts: [{ text: 'Xin l·ªói, t√¥i kh√¥ng th·ªÉ t·∫°o ra g·ª£i √Ω l√∫c n√†y. Vui l√≤ng th·ª≠ l·∫°i sau.' }] });
                    appendMessageToAIChat('model', 'Xin l·ªói, t√¥i kh√¥ng th·ªÉ t·∫°o ra g·ª£i √Ω l√∫c n√†y. Vui l√≤ng th·ª≠ l·∫°i sau.');
                }
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                removeThinkingIndicator(); // Remove thinking indicator on error
                aiChatHistory.push({ role: 'model', parts: [{ text: 'ƒê√£ x·∫£y ra l·ªói khi k·∫øt n·ªëi v·ªõi AI. Vui l√≤ng th·ª≠ l·∫°i.' }] });
                appendMessageToAIChat('model', 'ƒê√£ x·∫£y ra l·ªói khi k·∫øt n·ªëi v·ªõi AI. Vui l√≤ng th·ª≠ l·∫°i.');
            } finally {
                isAIChatGenerating = false;
                document.getElementById('ai-user-input').disabled = false;
                document.getElementById('ai-send-message-button').disabled = false;
                document.getElementById('ai-chat-history').scrollTop = document.getElementById('ai-chat-history').scrollHeight; // Scroll to bottom
            }
        }

        function appendMessageToAIChat(role, text, isHtml = false) {
            const chatHistoryEl = document.getElementById('ai-chat-history');
            const msgDiv = document.createElement('div');
            msgDiv.className = `mb-2 ${role === 'user' ? 'text-right' : 'text-left'}`;
            const span = document.createElement('span');
            span.className = `inline-block px-3 py-2 rounded-lg ${role === 'user' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-800'}`;
            
            if (isHtml) {
                span.innerHTML = text;
            } else {
                span.textContent = text;
            }
            msgDiv.appendChild(span);
            chatHistoryEl.appendChild(msgDiv);
            chatHistoryEl.scrollTop = chatHistoryEl.scrollHeight; // Scroll to bottom
        }

        function removeThinkingIndicator() {
            const chatHistoryEl = document.getElementById('ai-chat-history');
            const lastMessage = chatHistoryEl.lastChild;
            if (lastMessage && lastMessage.querySelector('.italic') && lastMessage.querySelector('.italic').textContent === 'AI ƒëang suy nghƒ©...') {
                chatHistoryEl.removeChild(lastMessage);
            }
        }


        // Service Comparison Logic
        function populateComparisonSelects() {
            const select1 = document.getElementById('service1-select-compare');
            const select2 = document.getElementById('service2-select-compare');
            select1.innerHTML = '<option value="">-- Ch·ªçn d·ªãch v·ª• --</option>';
            select2.innerHTML = '<option value="">-- Ch·ªçn d·ªãch v·ª• --</option>';

            services.forEach(service => {
                const option1 = document.createElement('option');
                option1.value = service.id;
                option1.textContent = service.name;
                select1.appendChild(option1);

                const option2 = document.createElement('option');
                option2.value = service.id;
                option2.textContent = service.name;
                select2.appendChild(option2);
            });
        }

        document.getElementById('compare-button').addEventListener('click', async () => {
            const service1Id = document.getElementById('service1-select-compare').value;
            const service2Id = document.getElementById('service2-select-compare').value;
            const errorMessageEl = document.getElementById('comparison-error-message');
            const compareButton = document.getElementById('compare-button');
            const compareSpinner = document.getElementById('compare-spinner');
            const compareText = document.getElementById('compare-text');
            const comparisonResultContainer = document.getElementById('comparison-result-container');
            const comparisonResultContent = document.getElementById('comparison-result-content');

            errorMessageEl.classList.add('hidden');
            comparisonResultContainer.classList.add('hidden');
            comparisonResultContent.textContent = '';

            if (!service1Id || !service2Id) {
                errorMessageEl.textContent = 'Vui l√≤ng ch·ªçn c·∫£ hai d·ªãch v·ª• ƒë·ªÉ so s√°nh.';
                errorMessageEl.classList.remove('hidden');
                return;
            }
            if (service1Id === service2Id) {
                errorMessageEl.textContent = 'Vui l√≤ng ch·ªçn hai d·ªãch v·ª• kh√°c nhau ƒë·ªÉ so s√°nh.';
                errorMessageEl.classList.remove('hidden');
                return;
            }

            setButtonLoading('compare-button', 'compare-spinner', 'compare-text', 'ƒêang so s√°nh...', 'So s√°nh ‚ú®', true);

            const s1Data = services.find(s => s.id === service1Id);
            const s2Data = services.find(s => s.id === service2Id);

            if (!s1Data || !s2Data) {
                errorMessageEl.textContent = 'Kh√¥ng t√¨m th·∫•y th√¥ng tin chi ti·∫øt cho m·ªôt ho·∫∑c c·∫£ hai d·ªãch v·ª• ƒë√£ ch·ªçn.';
                errorMessageEl.classList.remove('hidden');
                setButtonLoading('compare-button', 'compare-spinner', 'compare-text', 'ƒêang so s√°nh...', 'So s√°nh ‚ú®', false);
                return;
            }

            const llmPrompt = `H√£y so s√°nh hai d·ªãch v·ª• sau ƒë√¢y, l√†m n·ªïi b·∫≠t ƒëi·ªÉm gi·ªëng, kh√°c nhau v√† ƒë·ªëi t∆∞·ª£ng kh√°ch h√†ng/l·ª£i √≠ch ch√≠nh c·ªßa m·ªói d·ªãch v·ª•. Tr√¨nh b√†y d∆∞·ªõi d·∫°ng d·ªÖ hi·ªÉu, c√≥ th·ªÉ s·ª≠ d·ª•ng g·∫°ch ƒë·∫ßu d√≤ng ho·∫∑c b·∫£ng n·∫øu ph√π h·ª£p.

            D·ªãch v·ª• 1: ${s1Data.name}
            M√¥ t·∫£: ${s1Data.longDescription}

            D·ªãch v·ª• 2: ${s2Data.name}
            M√¥ t·∫£: ${s2Data.longDescription}

            So s√°nh:
            `;

            try {
                const payload = {
                    contents: [{ role: "user", parts: [{ text: llmPrompt }] }],
                    generationConfig: {
                        temperature: 0.6,
                        topP: 0.9,
                        topK: 40,
                    },
                };

                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    comparisonResultContent.innerHTML = text.replace(/\n/g, '<br/>');
                    comparisonResultContainer.classList.remove('hidden');
                } else {
                    comparisonResultContent.textContent = 'Kh√¥ng th·ªÉ t·∫°o so s√°nh l√∫c n√†y. Vui l√≤ng th·ª≠ l·∫°i sau.';
                    comparisonResultContainer.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error calling Gemini API for comparison:', error);
                comparisonResultContent.textContent = 'ƒê√£ x·∫£y ra l·ªói khi k·∫øt n·ªëi v·ªõi AI. Vui l√≤ng th·ª≠ l·∫°i.';
                comparisonResultContainer.classList.remove('hidden');
            } finally {
                setButtonLoading('compare-button', 'compare-spinner', 'compare-text', 'ƒêang so s√°nh...', 'So s√°nh ‚ú®', false);
            }
        });

        // --- Initial Render and Data Fetching ---

        function initFirebaseDataListeners() {
            if (db && currentUserId && canvasAppId) {
                const testimonialsCollectionRef = collection(db, `artifacts/${canvasAppId}/public/data/testimonials`);
                const q = query(testimonialsCollectionRef);

                onSnapshot(q, (snapshot) => {
                    testimonials = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    // Sort in memory as orderBy is removed from query
                    testimonials.sort((a, b) => (b.timestamp?.toDate()?.getTime() || 0) - (a.timestamp?.toDate()?.getTime() || 0));
                    renderTestimonials();
                }, (error) => {
                    console.error("Error fetching testimonials: ", error);
                    document.getElementById('testimonials-grid').innerHTML = '<p class="col-span-full text-center text-red-300 opacity-80 text-xl py-10">Kh√¥ng th·ªÉ t·∫£i ƒë√°nh gi√° kh√°ch h√†ng.</p>';
                });
            } else {
                console.warn("Firebase or userId not ready for testimonial fetching.");
                document.getElementById('testimonials-grid').innerHTML = '<p class="col-span-full text-center text-red-300 opacity-80 text-xl py-10">ƒêang ch·ªù k·∫øt n·ªëi Firebase ƒë·ªÉ t·∫£i ƒë√°nh gi√° kh√°ch h√†ng...</p>';
            }
        }


        // Function to run when the window loads
        window.onload = () => {
            renderServices();
            renderCategoriesNav();
            renderCategoryBanner();
            renderProcessSteps();
            renderFAQs();
            // Firebase init and testimonial fetching handled by useEffect-like logic inside module script
        };
    </script>
</body>
</html>
